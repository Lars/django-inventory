{% extends "base.html" %}
{% load i18n %}
{% load generic_views_helpers %}
{% load pagination_tags %}
{% load navigation %}
{% load carts %}
{% block title %} :: {% blocktrans %}{{ title }}{% endblocktrans %}{% endblock %}

{% block stylesheets %}
    {{ block.super }}
    <link rel="stylesheet" href="{{ STATIC_URL }}css/assets_list.css" type="text/css" media="screen" />
{% endblock %}

{% block content %}

<div class="block">
    <div class="content">
    <h3 class="title">
        {% ifnotequal page_obj.paginator.num_pages 1 %}
            {% with title|title as title and page_obj.start_index as start and page_obj.end_index as end and page_obj.paginator.count as total %}{% blocktrans %}{{ title }} ({{ start }} - {{ end }} out of {{ total }}){% endblocktrans %}{% endwith %}
        {% else %}
            {% with page_obj.paginator.count as total %}{{ title }} ({{ total }}){% endwith %}
        {% endifnotequal %}
    </h3>

<div class="inner">
{% with 1 as hide_links %}
  <form action="#" class="form" id="bl_list_form" method="POST">
    {% csrf_token %}
    {% paginate %}
    <table class="equipment-list">
    <thead>
        <tr>
        {% for col in columns %}
        <th class="{{col.attribute|default:'name'}}">
                {{ col.name|capfirst }}
        {% if col.url_spanclass %}<span class="{{ col.url_spanclass }}"></span>{% endif %}
        {% if col.subrows %}{% for row in col.subrows %}<br/>
                {{ row.name|capfirst }}
        {% endfor %}{%endif %}
        </th>
        {% endfor %}
        {% if not hide_links %}<th class=""></th>{% endif %}
        {% if request.session.carts %}<th class="">{% trans 'Select' %}</th>{% endif %}
</tr>
    </thead>

    <tbody>
        {# Render groupped results #}
        {% for group in group_results %}
            <tr class="bl_group">
            {% if group_fields %}{% for gf in group_fields %}
                <th {% if gf.colspan %}colspan="{{ gf.colspan }}"{% endif %}{% if forloop.first %}class="first_col"{% endif %}>
                    {% if gf.superrows %}{% for sr in gf.superrows %}
                        <p>{{ group.group|object_property:sr.attribute }}</p>
                    {% endfor %}{% endif %}
                    {% spaceless %}
                    {% if forloop.first %}
                        <a href="{{ group.url }}" class="{% if not group.items %}normal{% else %}expanded{% endif %}"><span>&nbsp;</span>
                    {% endif %}
                    {% if gf.attribute %}{{ group.group|object_property:gf.attribute }}{% else %}{{ group.group }}{% endif %}
                    {% if forloop.first %}({{group.items_count}})</a>{% endif %}
                    {% endspaceless %}
                </th>
            {% endfor %}{% else %}
                <td colspan="{{ columns|length}}"><a href="{{ group.url }}"> {{ group.group }} ({{group.items_count }}) </a>
                </td>
            {% endif %}
            {% if not hide_links %}<td class=""></td>{% endif %}
            {% if request.session.carts %}<td class=""></td>{% endif %}
            </tr>
            {% if group.items %}
            
            {% if sub_offset >= 0 %}
                <tr class="bl_inner_pagination">
                    <td class="first_col"></td>
                    <td colspan="8">
                    {% if sub_offset_prev %}
                        <a href="?{{sub_getvars}}sub_offset=0" title="{% trans 'First page' %}"><span class="parrow first"></span></a>
                        <a href="?{{sub_getvars}}sub_offset={{sub_offset_prev}}" title="{% trans 'Previous page' %}"><span class="parrow left"></span></a>
                    {% else %}<span class="parrow first"></span>
                              <span class="parrow left"></span>
                    {% endif %}
                    <div>{{ sub_offset }}</div>
                    {% if sub_offset_next %}
                        <a href="?{{sub_getvars}}sub_offset={{sub_offset_next}}" title="{% trans 'Next page' %}"><span class="parrow right"></span></a>
                        <a href="?{{sub_getvars}}sub_offset={{sub_offset_last}}" title="{% trans 'Last page' %}"><span class="parrow last"></span></a>
                    {% else %}<span class="parrow right"></span>
                        <span class="parrow last"></span>
                    {% endif %}
                    </td>
                </tr>
            {% endif %}

                {% for object in group.items %}
                <tr class="bl_inrow {% cycle 'odd' 'even2' %} {% if forloop.last %}bl_last{% endif %}">
            {% for col in columns %}
                {% if not col.attribute %}
                    {% if main_object %}
                    {% with object|object_property:main_object as object %}
                        <td {% if forloop.first %}class="first_col"{% endif %}>{% if not hide_link %}<a href="{{ object|object_property:url_attribute }}">{{ object }}</a>{% else %}{{ object }}{% endif %}
                    {% endwith %}
                    {% else %}
                        <td {% if forloop.first %}class="first_col"{% endif %}>{% if not hide_link %}<a href="{{ object|object_property:url_attribute }}">{{ object }}</a>{% else %}{{ object }}{% endif %}
                    {% endif %}
                {% else %}
                    <td {% if forloop.first %}class="first_col"{% endif %}>{{ object|object_property:col.attribute|default_if_none:'' }}
                {% endif %}
                {% if col.subrows %}{% for row in col.subrows %}<br/>
                        {{ object|object_property:row.attribute }}
                {% endfor %}{%endif %}
                </td>
            {% endfor %}
            {% if not hide_links %}
                <td class='last'>
                {% object_navigation_template %}
                </td>
            {% endif %}
            {% if request.session.carts %}
                {% object_carts object %}
            {% endif %}
            </tr>
            {% endfor %}{% endif %}
        {% empty %}
            <tr><td colspan=99 class="tc">{% blocktrans %}There are no {{ title }}{% endblocktrans %}</td></tr>
        {% endfor %}

    </tbody>
</table>
    {% paginate %}
    {% object_list_carts object_list %}
  </form>
{% endwith %}
</div>
</div>

    {% for subform in subforms_dict %}
    {% with subform.title as title %}
    {% with subform.extra_columns as extra_columns %}
    {% with subform.form as form %}
        {% include subform.name %}
    {% endwith %}
    {% endwith %}
    {% endwith %}
    {% endfor %}
</div>
{% endblock %}
