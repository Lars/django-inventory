{% extends "base.html" %}
{% load project_tags %}
{% load i18n %}
{% load navigation %}

{% block content %}
    <div class="content">
        <div class="tc"><h1>{{ user_profile.department.name }}</h1></div>

        <div class="block">
        {% get_object_navigation_links "my_pending" %}
        {% if object_navigation_links %}
            <h2>{% blocktrans %}My pending actions {% endblocktrans %}</h2>
            <ul class="navigation subtasks">
                {% with 'true' as as_li %}
                    {% include 'generic_navigation.html' %}
                {% endwith %}
            </ul>
        {% endif %}
        {% get_object_navigation_links "start_actions" %}
        {% if object_navigation_links %}
            <h2>{% blocktrans %}Available actions{% endblocktrans %}</h2>
            <ul class="navigation subtasks">
                {% with 'true' as as_li %}
                    {% include 'generic_navigation.html' %}
                {% endwith %}
            </ul>
        {% endif %}
        </div>
    </div>

        {% if user_roles %}
        <div class="content" style="float: right;">
            <div class="tc"> {% trans 'Select department and role:' %}</div>
            <div class="block">
            <form method="POST" action="{% url select_user_role %}">
            {% csrf_token %}
            <div id="wait_for_user_role" style="display: none;">{% trans 'Updating, please wait'%}</div>
            <select id="select_user_role" name="role_id" onchange="this.form.submit()">
                <option value="x">--------</option>
            {% for r in user_roles %}
                <option value="{{ r.id }}" {% if r.id == current_user_role %} selected="1" {% endif %}>
                    {{ r.department.name }} - {{ r.role.name }} </option>
            {% endfor %}
            </select></form>
            </div>
        </div>
        {% endif %}
{% comment %}
<script type="text/javascript">
function change_user_role(){
    var selected_val = $("#select_user_role option:selected").val();
    if (! selected_val)
        return false;

    $("#select_user_role").hide();
    $("#wait_for_user_role").show();

    /* response functions */
    function show_again() {
        $("#select_user_role").show();
        $("#wait_for_user_role").hide();
    }
    function on_success(data, status, xhr){
        console.log("Success!" + data.data);
        $("#select_user_role [value="+data.data + "]").prop("selected", true);
        // We have to reload, because actions may have changed:
        window.location.reload();
    }
    $("#select_user_role option:selected").prop("selected", false);

    $.ajax("{% url select_user_role %}", {
                'dataType': 'json',
                'data': {'role_id': selected_val },
                'success': on_success, 'complete': show_again,
            });
}

/* The way to do that in AJAX, but the reloading makes it redundant
    $(function () {
        $("#select_user_role").change(change_user_role);
    }); */
</script>
{% endcomment %}

{% endblock %}
{% block footer %}
    <div id="footer">
        <div class="block">
            <p style="font-size: 8pt;"><a href="{% url about %}">{% trans 'Based on Django-inventory' %}</p>
        </div>
    </div>
{% endblock %}
